
CREATE VIEW dbo.rptvueAccountProjectsReport
AS
SELECT     dbo.rptvueAccountProjectsTimesheet.AccountProjectId, dbo.rptvueAccountProjectsTimesheet.AccountId, dbo.rptvueAccountProjectsTimesheet.AccountProjectTypeId, dbo.rptvueAccountProjectsTimesheet.AccountClientId, 
                      dbo.rptvueAccountProjectsTimesheet.ProjectBillingTypeId, dbo.rptvueAccountProjectsTimesheet.ProjectName, dbo.rptvueAccountProjectsTimesheet.ProjectDescription, dbo.rptvueAccountProjectsTimesheet.StartDate, 
                      dbo.rptvueAccountProjectsTimesheet.AccountMilestoneId, dbo.rptvueAccountProjectsTimesheet.Deadline, dbo.rptvueAccountProjectsTimesheet.LeaderEmployeeId, dbo.rptvueAccountProjectsTimesheet.ProjectManagerEmployeeId, 
                      dbo.rptvueAccountProjectsTimesheet.EstimatedTime, dbo.rptvueAccountProjectsTimesheet.EstimatedDurationUnit, dbo.rptvueAccountProjectsTimesheet.ProjectCode, dbo.rptvueAccountProjectsTimesheet.DefaultBillingRate, 
                      dbo.rptvueAccountProjectsTimesheet.IsActive, dbo.rptvueAccountProjectsTimesheet.ProjectStatusId, dbo.rptvueAccountProjectsTimesheet.AccountPriorityId, dbo.rptvueAccountProjectsTimesheet.CreatedOn, 
                      dbo.rptvueAccountProjectsTimesheet.CreatedByEmployeeId, dbo.rptvueAccountProjectsTimesheet.ModifiedOn, dbo.rptvueAccountProjectsTimesheet.ModifiedByEmployeeId, dbo.rptvueAccountProjectsTimesheet.ProjectBillingRateTypeId, 
                      dbo.rptvueAccountProjectsTimesheet.TimeSheetApprovalTypeId, dbo.rptvueAccountProjectsTimesheet.ExpenseApprovalTypeId, dbo.rptvueAccountProjectsTimesheet.IsDisabled, dbo.rptvueAccountProjectsTimesheet.IsTemplate, dbo.rptvueAccountProjectsTimesheet.IsProject, 
                      dbo.rptvueAccountProjectsTimesheet.AccountProjectTemplateId, dbo.rptvueAccountProjectsTimesheet.ClientNick, dbo.rptvueAccountProjectsTimesheet.ClientName, dbo.rptvueAccountProjectsTimesheet.ProjectType, dbo.rptvueAccountProjectsTimesheet.BillingType, 
                      dbo.rptvueAccountProjectsTimesheet.Status, dbo.rptvueAccountProjectsTimesheet.EstimatedDuration, dbo.rptvueAccountProjectsTimesheet.AccountClientContactId, dbo.rptvueAccountProjectsTimesheet.AccountClientDepartmentId, 
                      dbo.rptvueAccountProjectsTimesheet.ClientDepartmentCode, dbo.rptvueAccountProjectsTimesheet.ClientDepartmentName, dbo.rptvueAccountProjectsTimesheet.ClientDepartmentLocation, dbo.rptvueAccountProjectsTimesheet.ExpenseApprovalTypeName, 
                      dbo.rptvueAccountProjectsTimesheet.TimesheetApprovalTypeName, dbo.rptvueAccountProjectsTimesheet.ClientContactName, dbo.rptvueAccountProjectsTimesheet.TeamLead, dbo.rptvueAccountProjectsTimesheet.ProjectManager, 
                      dbo.rptvueAccountProjectsTimesheet.ProjectBillingRateType, dbo.rptvueAccountProjectsTimesheet.BillableTotalHours, dbo.rptvueAccountProjectsTimesheet.NonBillableTotalHours, dbo.rptvueAccountProjectsTimesheet.TotalEmployeeCost, 
                      dbo.rptvueAccountProjectsTimesheet.TotalTimeAmount, dbo.rptvueAccountProjectsTimesheet.TotalTaskEstimatedCost, dbo.rptvueAccountProjectsTimesheet.TotalBillableExpense, dbo.rptvueAccountProjectsTimesheet.TotalNonBillableExpense, 
                      dbo.rptvueAccountProjectsTimesheet.NetAmount, dbo.rptvueAccountProjectsTimesheet.TotalTaskEstimatedHours, dbo.rptvueAccountProjectsTimesheet.TotalHours, dbo.rptvueAccountProjectsTimesheet.BillableTimeAmount, 
                      dbo.rptvueAccountProjectsTimesheet.NonBillableTimeAmount, ISNULL(dbo.rptvueAccountProjectsTimesheet.BilledTimeAmount, 0) AS BilledTimeAmount, ISNULL(SUM(dbo.vueBillingExpense.BilledExpenseAmount), 0) AS BilledExpenseAmount, 
                      dbo.rptvueAccountProjectsTimesheet.CurrencyNetAmount, dbo.rptvueAccountProjectsTimesheet.CustomField1, dbo.rptvueAccountProjectsTimesheet.CustomField2, dbo.rptvueAccountProjectsTimesheet.CustomField3, 
                      dbo.rptvueAccountProjectsTimesheet.CustomField4, dbo.rptvueAccountProjectsTimesheet.CustomField5, dbo.rptvueAccountProjectsTimesheet.CustomField6, dbo.rptvueAccountProjectsTimesheet.CustomField7, 
                      dbo.rptvueAccountProjectsTimesheet.CustomField8, dbo.rptvueAccountProjectsTimesheet.CustomField9, dbo.rptvueAccountProjectsTimesheet.CustomField10, dbo.rptvueAccountProjectsTimesheet.CustomField11, 
                      dbo.rptvueAccountProjectsTimesheet.CustomField12, dbo.rptvueAccountProjectsTimesheet.CustomField13, dbo.rptvueAccountProjectsTimesheet.CustomField14, dbo.rptvueAccountProjectsTimesheet.CustomField15, 
                      ISNULL(dbo.rptvueAccountProjectsTimesheet.ProjectEstimatedCost, 0) AS ProjectBudget, ISNULL(dbo.rptvueAccountProjectsTimesheet.ProjectEstimatedCost, 0) - (ISNULL(dbo.rptvueAccountProjectsTimesheet.BillableTimeAmount, 0)) AS ProjectBudgetLeft, 
                      ISNULL(dbo.rptvueAccountProjectsTimesheet.BillableTimeAmount, 0) AS ProjectSpentToDate
FROM         dbo.rptvueAccountProjectsTimesheet LEFT OUTER JOIN
                      dbo.vueBillingExpense ON dbo.rptvueAccountProjectsTimesheet.AccountProjectId = dbo.vueBillingExpense.AccountProjectId
GROUP BY dbo.rptvueAccountProjectsTimesheet.AccountProjectId, dbo.rptvueAccountProjectsTimesheet.AccountId, dbo.rptvueAccountProjectsTimesheet.AccountProjectTypeId, dbo.rptvueAccountProjectsTimesheet.AccountClientId, 
                      dbo.rptvueAccountProjectsTimesheet.ProjectBillingTypeId, dbo.rptvueAccountProjectsTimesheet.ProjectName, dbo.rptvueAccountProjectsTimesheet.ProjectDescription, dbo.rptvueAccountProjectsTimesheet.StartDate, 
                      dbo.rptvueAccountProjectsTimesheet.AccountMilestoneId, dbo.rptvueAccountProjectsTimesheet.Deadline, dbo.rptvueAccountProjectsTimesheet.LeaderEmployeeId, dbo.rptvueAccountProjectsTimesheet.ProjectManagerEmployeeId, 
                      dbo.rptvueAccountProjectsTimesheet.EstimatedTime, dbo.rptvueAccountProjectsTimesheet.EstimatedDurationUnit, dbo.rptvueAccountProjectsTimesheet.ProjectCode, dbo.rptvueAccountProjectsTimesheet.DefaultBillingRate, 
                      dbo.rptvueAccountProjectsTimesheet.IsActive, dbo.rptvueAccountProjectsTimesheet.ProjectStatusId, dbo.rptvueAccountProjectsTimesheet.AccountPriorityId, dbo.rptvueAccountProjectsTimesheet.CreatedOn, 
                      dbo.rptvueAccountProjectsTimesheet.CreatedByEmployeeId, dbo.rptvueAccountProjectsTimesheet.ModifiedOn, dbo.rptvueAccountProjectsTimesheet.ModifiedByEmployeeId, dbo.rptvueAccountProjectsTimesheet.ProjectBillingRateTypeId, 
                      dbo.rptvueAccountProjectsTimesheet.TimeSheetApprovalTypeId, dbo.rptvueAccountProjectsTimesheet.ExpenseApprovalTypeId, dbo.rptvueAccountProjectsTimesheet.IsDisabled, dbo.rptvueAccountProjectsTimesheet.IsTemplate, dbo.rptvueAccountProjectsTimesheet.IsProject, 
                      dbo.rptvueAccountProjectsTimesheet.AccountProjectTemplateId, dbo.rptvueAccountProjectsTimesheet.ClientNick, dbo.rptvueAccountProjectsTimesheet.ClientName, dbo.rptvueAccountProjectsTimesheet.ProjectType, dbo.rptvueAccountProjectsTimesheet.BillingType, 
                      dbo.rptvueAccountProjectsTimesheet.Status, dbo.rptvueAccountProjectsTimesheet.EstimatedDuration, dbo.rptvueAccountProjectsTimesheet.AccountClientContactId, dbo.rptvueAccountProjectsTimesheet.AccountClientDepartmentId, 
                      dbo.rptvueAccountProjectsTimesheet.ClientDepartmentCode, dbo.rptvueAccountProjectsTimesheet.ClientDepartmentName, dbo.rptvueAccountProjectsTimesheet.ClientDepartmentLocation, dbo.rptvueAccountProjectsTimesheet.ExpenseApprovalTypeName, 
                      dbo.rptvueAccountProjectsTimesheet.TimesheetApprovalTypeName, dbo.rptvueAccountProjectsTimesheet.ClientContactName, dbo.rptvueAccountProjectsTimesheet.TeamLead, dbo.rptvueAccountProjectsTimesheet.ProjectManager, 
                      dbo.rptvueAccountProjectsTimesheet.ProjectBillingRateType, dbo.rptvueAccountProjectsTimesheet.BillableTotalHours, dbo.rptvueAccountProjectsTimesheet.NonBillableTotalHours, dbo.rptvueAccountProjectsTimesheet.TotalEmployeeCost, 
                      dbo.rptvueAccountProjectsTimesheet.TotalTimeAmount, dbo.rptvueAccountProjectsTimesheet.TotalTaskEstimatedCost, dbo.rptvueAccountProjectsTimesheet.TotalBillableExpense, dbo.rptvueAccountProjectsTimesheet.TotalNonBillableExpense, 
                      dbo.rptvueAccountProjectsTimesheet.NetAmount, dbo.rptvueAccountProjectsTimesheet.TotalTaskEstimatedHours, dbo.rptvueAccountProjectsTimesheet.TotalHours, dbo.rptvueAccountProjectsTimesheet.BillableTimeAmount, 
                      dbo.rptvueAccountProjectsTimesheet.NonBillableTimeAmount, dbo.rptvueAccountProjectsTimesheet.BilledTimeAmount, dbo.rptvueAccountProjectsTimesheet.CurrencyNetAmount, dbo.rptvueAccountProjectsTimesheet.CustomField1, 
                      dbo.rptvueAccountProjectsTimesheet.CustomField2, dbo.rptvueAccountProjectsTimesheet.CustomField3, dbo.rptvueAccountProjectsTimesheet.CustomField4, dbo.rptvueAccountProjectsTimesheet.CustomField5, 
                      dbo.rptvueAccountProjectsTimesheet.CustomField6, dbo.rptvueAccountProjectsTimesheet.CustomField7, dbo.rptvueAccountProjectsTimesheet.CustomField8, dbo.rptvueAccountProjectsTimesheet.CustomField9, 
                      dbo.rptvueAccountProjectsTimesheet.CustomField10, dbo.rptvueAccountProjectsTimesheet.CustomField11, dbo.rptvueAccountProjectsTimesheet.CustomField12, dbo.rptvueAccountProjectsTimesheet.CustomField13, 
                      dbo.rptvueAccountProjectsTimesheet.CustomField14, dbo.rptvueAccountProjectsTimesheet.CustomField15, dbo.rptvueAccountProjectsTimesheet.ProjectEstimatedCost